clear; close all; clc;

% Normal refract
% Data from https://refractiveindex.info/?shelf=3d&book=crystals&page=ice
wavelength1 = [350.0, 400.0, 410.0, 420.0, 430.0, 440.0, 450.0, 460.0, 470.0, ...
    480.0, 490.0, 500.0, 510.0, 520.0, 530.0, 540.0, 550.0, 560.0, 570.0, ...
    580.0, 590.0, 600.0, 610.0, 620.0, 630.0, 640.0, 650.0, 660.0, 670.0, ...
    680.0, 690.0, 700.0, 710.0, 720.0, 730.0, 740.0, 750.0, 760.0, 770.0, ...
    780.0, 790.0, 800.0, 810.0, 820.0, 830.0, 840.0, 850.0, 860.0, 870.0, ...
    880.0, 890.0, 900.0];
refract_index1 = [1.3249, 1.3194, 1.3185, 1.3177, 1.3170, 1.3163, 1.3157, 1.3151, ...
    1.3145, 1.3140, 1.3135, 1.3130, 1.3126, 1.3122, 1.3118, 1.3114, 1.3110, ...
    1.3106, 1.3103, 1.3100, 1.3097, 1.3094, 1.3091, 1.3088, 1.3085, 1.3083, ...
    1.3080, 1.3078, 1.3076, 1.3073, 1.3071, 1.3069, 1.3067, 1.3065, 1.3062, ...
    1.3060, 1.3058, 1.3057, 1.3055, 1.3053, 1.3051, 1.3049, 1.3047, 1.3045, ...
    1.3044, 1.3042, 1.3040, 1.3038, 1.3037, 1.3035, 1.3033, 1.3032];

% The two-term Sellmeier equation:
% n^2 = 1 + B1 * lambda^2 / (lambda^2 - C1)
%         + B2 * lambda^2 / (lambda^2 - C2)

coef0 = [1, 1; 1, 1];
options = optimset('display', 'off');
[coef_opt1, err1] = fminsearch(@(coef)mean(abs(shellmeier2(coef, wavelength1) - ...
    refract_index1)), coef0, options);

tmp_wavelength = 350:900;
figure(1); clf;
hold on;
plot(wavelength1, refract_index1, 'o');
plot(tmp_wavelength, shellmeier2(coef_opt1, tmp_wavelength), 'r');
box on;

% Birefrigence
% Data from 'Physics of Ice' page 220, Table 9.2
wavelength2 = [405, 436, 492, 546, 589, 624, 691];
refract_index2 = [1.3185, 1.3161, 1.3128, ...
    1.3105, 1.3091, 1.3082, 1.3067;
    1.3200, 1.3176, 1.3143, 1.3119, 1.3105, 1.3096, 1.3081];

[coef_opt2, err2] = fminsearch(@(coef)mean(abs(shellmeier2(coef, wavelength2) - ...
    refract_index2(1,:))), coef_opt1, options);
[coef_opt3, err3] = fminsearch(@(coef)mean(abs(shellmeier2(coef, wavelength2) - ...
    refract_index2(2,:))), coef_opt1, options);

figure(2); clf;
hold on;
plot(wavelength2, refract_index2(1,:), 'o', ...
    wavelength2, refract_index2(2,:), 'x');
plot(tmp_wavelength, shellmeier2(coef_opt2, tmp_wavelength), 'r', ...
    tmp_wavelength, shellmeier2(coef_opt3, tmp_wavelength), 'm');
box on;
